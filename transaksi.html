<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaksi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container my-5">
        <h1>Transaksi</h1>
        
        <!-- Form Tambah Produk ke Keranjang -->
        <div class="card mb-4">
            <div class="card-body">
                <h5>Tambah Produk ke Keranjang</h5>
                <form id="formTambahKeranjang">
                    <div class="row">
                        <div class="col-md-3">
                            <label for="produkSelect" class="form-label">Produk</label>
                            <select id="produkSelect" class="form-select" required>
                                <!-- Opsi Produk akan ditambahkan melalui JavaScript -->
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="jumlahProduk" class="form-label">Jumlah</label>
                            <input type="number" id="jumlahProduk" class="form-control" min="1" required>
                        </div>
                        <div class="col-md-2">
                            <label for="diskonPeran" class="form-label">Diskon (Opsional)</label>
                            <input type="text" id="diskonPeran" class="form-control" readonly>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">&nbsp;</label>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-cart-plus"></i> Tambah ke Keranjang
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Keranjang -->
        <div class="card mb-4">
            <div class="card-body">
                <h5>Keranjang Belanja</h5>
                <table class="table table-bordered" id="keranjangTable">
                    <thead>
                        <tr>
                            <th>Produk</th>
                            <th>Harga</th>
                            <th>Jumlah</th>
                            <th>Subtotal</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Isi keranjang akan ditambahkan melalui JavaScript -->
                    </tbody>
                </table>
                <div class="d-flex justify-content-between">
                    <h5>Total: <span id="totalHarga">0</span></h5>
                    <button id="btnBayar" class="btn btn-success" disabled>
                        <i class="fas fa-money-bill-wave"></i> Bayar
                    </button>
                </div>
            </div>
        </div>

        <!-- Daftar Transaksi -->
        <h3>Daftar Transaksi</h3>
        <table class="table table-striped" id="transaksiTable">
            <thead>
                <tr>
                    <th>ID Transaksi</th>
                    <th>Nama Pelanggan</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data transaksi akan ditampilkan melalui JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        // Simulasi data pelanggan dan produk
        const pelangganList = [
            { id: 'P001', nama: 'Ali', peran: 'Umum' },
            { id: 'P002', nama: 'Budi', peran: 'Member' },
        ];

        const produkList = [
            { id: 'PR001', nama: 'Produk A', harga: 10000 },
            { id: 'PR002', nama: 'Produk B', harga: 20000 },
        ];

        let keranjang = [];
        let transaksiList = JSON.parse(localStorage.getItem('transaksi')) || [];

        // Menampilkan produk di form
        const produkSelect = document.getElementById('produkSelect');
        produkList.forEach(produk => {
            const option = document.createElement('option');
            option.value = produk.id;
            option.textContent = `${produk.nama} - Rp${produk.harga}`;
            produkSelect.appendChild(option);
        });

        // Tambahkan produk ke keranjang
        document.getElementById('formTambahKeranjang').addEventListener('submit', function (e) {
            e.preventDefault();

            const produkId = produkSelect.value;
            const jumlah = parseInt(document.getElementById('jumlahProduk').value);
            const produk = produkList.find(p => p.id === produkId);

            if (produk) {
                const itemKeranjang = keranjang.find(k => k.id === produkId);
                if (itemKeranjang) {
                    itemKeranjang.jumlah += jumlah;
                } else {
                    keranjang.push({ id: produk.id, nama: produk.nama, harga: produk.harga, jumlah });
                }
                updateKeranjang();
            }
        });

        // Menampilkan keranjang
        function updateKeranjang() {
            const keranjangTable = document.getElementById('keranjangTable').getElementsByTagName('tbody')[0];
            keranjangTable.innerHTML = '';

            let total = 0;
            keranjang.forEach(item => {
                const subtotal = item.harga * item.jumlah;
                total += subtotal;

                const row = keranjangTable.insertRow();
                row.innerHTML = `
                    <td>${item.nama}</td>
                    <td>${item.harga}</td>
                    <td>${item.jumlah}</td>
                    <td>${subtotal}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="hapusItemKeranjang('${item.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
            });

            document.getElementById('totalHarga').textContent = total;
            document.getElementById('btnBayar').disabled = keranjang.length === 0;
        }

        // Hapus item dari keranjang
        function hapusItemKeranjang(id) {
            keranjang = keranjang.filter(item => item.id !== id);
            updateKeranjang();
        }

        // Proses pembayaran
        document.getElementById('btnBayar').addEventListener('click', function () {
            const total = keranjang.reduce((acc, item) => acc + (item.harga * item.jumlah), 0);
            const idTransaksi = `TR${Date.now()}`;
            const namaPelanggan = pelangganList[0].nama; // Default pelanggan (simulasi)

            transaksiList.push({
                id: idTransaksi,
                namaPelanggan,
                total,
                status: 'Lunas',
            });

            localStorage.setItem('transaksi', JSON.stringify(transaksiList));
            keranjang = [];
            updateKeranjang();
            updateTransaksi();
        });

        // Tampilkan daftar transaksi
        function updateTransaksi() {
            const transaksiTable = document.getElementById('transaksiTable').getElementsByTagName('tbody')[0];
            transaksiTable.innerHTML = '';

            transaksiList.forEach(transaksi => {
                const row = transaksiTable.insertRow();
                row.innerHTML = `
                    <td>${transaksi.id}</td>
                    <td>${transaksi.namaPelanggan}</td>
                    <td>${transaksi.total}</td>
                    <td>${transaksi.status}</td>
                    <td>
                        <button class="btn btn-info btn-sm">
                            <i class="fas fa-info-circle"></i> Detail
                        </button>
                    </td>
                `;
            });
        }

        // Inisialisasi halaman
        updateKeranjang();
        updateTransaksi();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
